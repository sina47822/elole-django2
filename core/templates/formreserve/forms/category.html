{% extends "core/base.html" %}
{% load i18n %}
{% block extra_css_no_compress %} 
<style>

</style>
{% endblock extra_css_no_compress %}

{% block content %}

<div style="margin: 200px;" >
    {% include "./nav.html" %}

    <div id="content" class=" d-flex flex-column justify-content-center align-items-center">
        <h1>انتخاب دسته بندی</h1>

        <form method="post" id="reservation-form">
            {% csrf_token %}
            <label for="category">Choose a category:</label>
            <select id="category" name="service_category">
                <option value="">Select a category</option>
                {% for category in categories %}
                    {% if category.id == category_id %}
                    <option selected value="{{ category.id }}">{{ category.title }}</option>
                    {% else %}
                    <option value="{{ category.id }}">{{ category.title }}</option>
                    {% endif %}
                {% endfor %}
            </select>
            <br><br>
            
            <!-- Add other form fields as necessary -->
            
            <button class="reserve-button btn btn-primary" type="submit">بعدی</button>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    console.log('{% url "reserveform:review" %}');
    $(document).ready(function() {
        $('#reservation-form').on('submit', function(event) {
            event.preventDefault(); // Prevent default form submission
        
            var formData = $(this).serialize(); // Serialize form data
            
            $.ajax({
                type: 'POST',
                url: '{% url "reserveform:category" %}',
                data: formData,
                success: function(response) {
                    if (response.success) {
                        window.location.href = response.redirect_url; // Redirect to services
                    } else {
                        alert('Error: ' + JSON.stringify(response.errors)); // Handle validation errors
                    }
                },
                error: function(xhr, status, error) {
                    console.error('AJAX Error:', status, error);
                    alert('An error occurred while processing your request: ' + xhr.responseText);
                }
            });
        });
    });
</script>
{% endblock %}