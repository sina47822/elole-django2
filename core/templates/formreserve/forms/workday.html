{% extends "core/base.html" %}
{% load i18n %}
{% load static%}

{% block extra_css_no_compress %} 
<style>
    .selectable-image {
        width: 150px;
        height: auto;
        transition: all 0.3s ease; /* Apply transition on all properties */
    }
    
    /* Styling for the selected image */
    .selected-image {
        border: 3px solid #00f;    /* Highlight with a blue border */
        filter: brightness(1.2);   /* Make the image slightly brighter */
        transform: scale(1.05);    /* Slightly enlarge the selected image */
        transition: all 0.3s ease; /* Ensure smooth transition for border, filter, and transform */
    }
</style>
<link href="{% static 'plugins/persiandate/css/persian-datepicker.min.css' %}" rel="stylesheet">

{% endblock extra_css_no_compress %}


{% block content %}
<div style="margin: 200px;" >
    {% include "./nav.html" %}

    {% comment %} <div id="content" class=" d-flex flex-column justify-content-center align-items-center pick-date-holder">
        <h3 class="title">انتخاب تاریخ رزرو</h3>
        <p class="subtitle">تاریخ مورد نظر رزرو خود را انتخاب کنید</p>

        <form method="post" id="reservation-form" class="pick-reserve-date">
            {% csrf_token %}
            
            <!-- Persian Date Input -->
            <label for="workday">انتخاب تاریخ رزرو</label>
            <input type="text" id="datepicker" name="day" class="form-control has-persian-datepicker" placeholder="Select a date" required>            
            
            
            <br><br>
            <button class="reserve-button btn btn-primary" type="submit">Next</button>
        </form>

        </div>
    </div> {% endcomment %}
      
    <input type="hidden" id="inlineExampleAlt" class="locale-fa" />
    <div class="locale-fa" ></div>

</div>

<form method="post" id="reservation-form" class="pick-reserve-date">
    {% csrf_token %}
    
    <!-- Persian Date Input -->
    <label for="selected-date">انتخاب تاریخ رزرو</label>
    {% comment %} <input type="text" id="datepicker" name="day" class="form-control has-persian-datepicker" placeholder="Select a date" required>             {% endcomment %}
    
    <!-- Hidden input to store the selected date in YYYY-MM-DD format -->
    <input type="hidden" id="selected-date" name="selected_date" value="">

    <br><br>
    <button class="reserve-button btn btn-primary" type="submit">Next</button>
</form>
{% endblock %}

{% block extra_js %}
<script src="{% static 'plugins/persiandate/js/persian-date.min.js' %}"></script>
<script src="{% static 'plugins/persiandate/js/persiandatepicker.min.js' %}"></script>

<script type="text/javascript">
    $(document).ready(function() {
        var availableDates = [
            {% for date in workdays_formatted %}
                '{{ date }}',  // These are Gregorian dates in 'YYYY-MM-DD' format
            {% endfor %}
        ];

        var availablePersianDates = availableDates.map(function(gregorianDate) {
            var persianDateObj = new persianDate(new Date(gregorianDate)).format('YYYY-MM-DD');
            return persianDateObj;
        });

        console.log('Available Persian Dates:', availablePersianDates);

        $('.locale-fa').persianDatepicker({
            inline: true,
            navigator: {
                scroll: {
                    enabled: false
                }
            },
            minDate: new persianDate().subtract('month', 3).valueOf(),
            checkDate: function(unix) {
                var selectedPersianDate = new persianDate(unix).format('YYYY-MM-DD');
                var isAvailable = availablePersianDates.includes(selectedPersianDate);
                return isAvailable;
            },
            onSelect: function(unix) {
                var selectedPersianDate = new persianDate(unix).format('YYYY-MM-DD');
                console.log('Selected Persian Date:', selectedPersianDate);

                // Set the selected date in the hidden input field
                $('#selected-date').val(selectedPersianDate);
            }
        });

        // Handle AJAX form submission
        $('#reservation-form').on('submit', function(e) {
            e.preventDefault(); // Prevent the default form submission
            
            // Gather form data
            var formData = $(this).serialize();

            $.ajax({
                url: "{% url 'reserveform:workday' %}", // Your form submission URL
                type: "POST",
                data: formData,
                success: function(response) {
                    // Handle success (e.g., redirect or show a success message)
                    console.log("Reservation submitted successfully!");
                    window.location.href = "{% url 'reserveform:workhour' %}"; // Redirect after success
                },
                error: function(xhr, status, error) {
                    // Handle error
                    console.error("Form submission failed: ", status, error);
                    alert("There was an error submitting the form. Please try again.");
                }
            });
        });
    });
</script>
{% comment %} <script type="text/javascript">
    $(document).ready(function() {
        var availableDates = [
            {% for date in workdays_formatted %}
                '{{ date }}',  // These are Gregorian dates in 'YYYY-MM-DD' format
            {% endfor %}
        ];

        // Convert available Gregorian dates to Persian dates
        var availablePersianDates = availableDates.map(function(gregorianDate) {
            // Convert each Gregorian date (YYYY-MM-DD) to Persian date
            var persianDateObj = new persianDate(new Date(gregorianDate)).format('YYYY-MM-DD');
            return persianDateObj;
        });

        console.log('Available Persian Dates:', availablePersianDates); // Log available Persian dates

        $('.locale-fa').persianDatepicker({
            inline: true,
            navigator: {
                scroll: {
                    enabled: false
                }
            },
            minDate: new persianDate().subtract('month', 3).valueOf(),
            checkDate: function(unix) {
                // Convert the selected Unix timestamp to Persian date (YYYY-MM-DD)
                var selectedPersianDate = new persianDate(unix).format('YYYY-MM-DD');
                var isAvailable = availablePersianDates.includes(selectedPersianDate);
                return isAvailable; // Check if the selected Persian date is in the available dates
            },
            onSelect: function(unix) {
                // Convert the selected Unix timestamp to Persian date (YYYY-MM-DD)
                var selectedPersianDate = new persianDate(unix).format('YYYY-MM-DD');
                console.log('Selected Persian Date:', selectedPersianDate); // Log selected Persian date

                // Check if the selected Persian date is in the allowed Persian dates array
                if (!availablePersianDates.includes(selectedPersianDate)) {
                    alert('This date is not available for selection.'); // Optionally alert the user
                    $(this).val(''); // Clear the input if the date is not selectable
                }
            }
        });
    });
</script> {% endcomment %}

{% comment %} <script>
    $(document).ready(function() {
        var availableDates = [
            {% for workday in workdays %}
                '{{ workday.day|date:"Y-m-d" }}',
            {% endfor %}
        ];
    console.log('Available Dates:', availableDates); // Log available dates

        // Initialize Persian datepicker
        $("#workday").pDatepicker({
            inline: true,
            altField: '#workday',
            altFormat: 'YYYY-MM-DD',
            autoClose: true,
            navigator: {
                scroll: {
                    enabled: false
                }
            },
            minDate: new persianDate().unix(), // Restrict to future dates
            onSelect: function(unix) {
                var dateStr = new persianDate(unix).format('YYYY-MM-DD');
                if (!availableDates.includes(dateStr)) {
                    alert('This date is not available for selection.'); // Optionally alert the user
                    $(this).val(''); // Clear the input if the date is not selectable
                }
            }

        });

    });

</script> {% endcomment %}

{% endblock extra_js %}

