{% extends "core/base.html" %}
{% load i18n %}
{% load static%}

{% block extra_css_no_compress %} 
<style>
    .selectable-image {
        width: 150px;
        height: auto;
        transition: all 0.3s ease; /* Apply transition on all properties */
    }
    
    /* Styling for the selected image */
    .selected-image {
        border: 3px solid #00f;    /* Highlight with a blue border */
        filter: brightness(1.2);   /* Make the image slightly brighter */
        transform: scale(1.05);    /* Slightly enlarge the selected image */
        transition: all 0.3s ease; /* Ensure smooth transition for border, filter, and transform */
    }
</style>
<style>
    /* Hide each navigation item by default */
    .nav-category,
    .nav-services,
    .nav-stylist,
    .nav-workday,
    .nav-workhour,
    .nav-review {
        opacity: 0;
        transform: translateY(20px); /* Move it downwards initially */
        visibility: hidden; /* Hide it initially */
        transition: all 0.5s ease; /* Smooth transition for appearance */
    }
    
    /* Make them visible with the 'active' class */
    .nav-category.active,
    .nav-services.active,
    .nav-stylist.active,
    .nav-workday.active,
    .nav-workhour.active,
    .nav-review.active {
        opacity: 1;
        transform: translateY(0); /* Move it back to its original position */
        visibility: visible;
    }
    
    /* Optional: Add transition delay for a cascading effect */
    .nav-services.active {
        transition-delay: 0.1s;
    }
    .nav-stylist.active {
        transition-delay: 0.2s;
    }
    .nav-workday.active {
        transition-delay: 0.3s;
    }
    .nav-workhour.active {
        transition-delay: 0.4s;
    }
    .nav-review.active {
        transition-delay: 0.5s;
    }
</style>
<link href="{% static 'plugins/persiandate/css/persian-datepicker.min.css' %}" rel="stylesheet">

{% endblock extra_css_no_compress %}


{% block content %}
<div style="margin: 200px;" >
    {% include "./nav.html" %}
    <form method="post" id="reservation-form" class="pick-reserve-date">
        {% csrf_token %}

        <label for="selected-date">انتخاب تاریخ رزرو</label>


            <div class="locale-fa"></div>
            <input type="hidden" name="day" id="selected-date" >
        <button class="reserve-button btn btn-primary" type="submit">Next</button>
    </form>

</div>


{% endblock %}

{% block extra_js %}
<script src="{% static 'plugins/persiandate/js/persian-date.min.js' %}"></script>
<script src="{% static 'plugins/persiandate/js/persiandatepicker.min.js' %}"></script>
<script> 
    document.addEventListener('DOMContentLoaded', function() {
        const currentStep = "{{ request.resolver_match.url_name }}"; // Get the current step from Django context
        const steps = ['category', 'services', 'stylist', 'workday', 'workhour', 'review'];
    
        steps.forEach(step => {
            if (currentStep === step || steps.indexOf(step) <= steps.indexOf(currentStep)) {
                document.querySelector(`.nav-${step}`).classList.add('active');
            }
        });
    });
</script>
<script type="text/javascript">
    let day = null

    $(document).ready(function() {
        var today = new persianDate();
        var availableDates = [
            {% for date in workdays_formatted %}
                '{{ date }}',  // These are Gregorian dates in 'YYYY-MM-DD' format
            {% endfor %}
        ];

        var availablePersianDates = availableDates.map(function(gregorianDate) {
            var persianDateObj = new persianDate(new Date(gregorianDate)).format('YYYY-MM-DD');
            return persianDateObj;
        });

        console.log('Available Persian Dates:', availablePersianDates);
        console.log('Available gregorianDate Dates:', availableDates);

        $('.locale-fa').persianDatepicker({
            inline: true,
            navigator: {
                scroll: {
                    enabled: false
                }
            },
            minDate: today.valueOf(),
            checkDate: function(unix) {
                var selectedPersianDate = new persianDate(unix).format('YYYY-MM-DD');
                var isAvailable = availablePersianDates.includes(selectedPersianDate);
                return isAvailable;
            },
            onSelect: function(unix) {
                var selectedPersianDate = new persianDate(unix).format('YYYY-MM-DD');
                
                // Get the index of the selected Persian date
                var selectedIndex = availablePersianDates.indexOf(selectedPersianDate);
                console.log('Selected Index:', selectedIndex);

                // Use the index to get the corresponding Gregorian date
                var gregorianDate = availableDates[selectedIndex];
                console.log('Corresponding Gregorian Date:', gregorianDate);
                
                console.log('Selected Persian Date:', selectedPersianDate);
                // Set the selected Persian date in the hidden input field
                $('#selected-date').val(gregorianDate);
            }
        });

        $('#reservation-form').on('submit', function(e) {
            e.preventDefault(); // Prevent default form submission
            formData = $(this).serialize();

            $.ajax({
                url: "{% url 'reserveform:workday' %}",  // Your form submission URL
                type: "POST",
                data: formData,  // Send the form data
                success: function(response) {
                    console.log("Reservation submitted successfully!", response);
                    window.location.href = "{% url 'reserveform:workhour' %}";  // Redirect after success
                },
                error: function(xhr, status, error) {
                    console.error("Form submission failed: ", status, error);
                    alert("There was an error submitting the form. Please try again.");
                }
            });
        });
    });


    
</script>

{% endblock extra_js %}

