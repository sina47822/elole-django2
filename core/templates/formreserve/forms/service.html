{% extends "core/base.html" %}
{% load i18n %}
{% block extra_css_no_compress %} 
<style>
    /* Hide each navigation item by default */
    .nav-category,
    .nav-services,
    .nav-stylist,
    .nav-workday,
    .nav-workhour,
    .nav-review {
        opacity: 0;
        transform: translateY(20px); /* Move it downwards initially */
        visibility: hidden; /* Hide it initially */
        transition: all 0.5s ease; /* Smooth transition for appearance */
    }
    
    /* Make them visible with the 'active' class */
    .nav-category.active,
    .nav-services.active,
    .nav-stylist.active,
    .nav-workday.active,
    .nav-workhour.active,
    .nav-review.active {
        opacity: 1;
        transform: translateY(0); /* Move it back to its original position */
        visibility: visible;
    }
    
    /* Optional: Add transition delay for a cascading effect */
    .nav-services.active {
        transition-delay: 0.1s;
    }
    .nav-stylist.active {
        transition-delay: 0.2s;
    }
    .nav-workday.active {
        transition-delay: 0.3s;
    }
    .nav-workhour.active {
        transition-delay: 0.4s;
    }
    .nav-review.active {
        transition-delay: 0.5s;
    }
</style>
{% endblock extra_css_no_compress %}
{% block content %}
<div style="margin: 200px;" >
    {% include "./nav.html" %}

    <div id="content" class=" d-flex flex-column justify-content-center align-items-center">
        <h1>انتخاب سرویس</h1>
        
        <form method="post" id="reservation-form">
            {% csrf_token %}
            <div class="service-selection row">
                {% for service in services %}
                <div class="col-md-4 col-sm-2">
                    <label for="service-{{ service.id }}">
                        <input type="radio" id="service-{{ service.id }}" name="service" hidden value="{{ service.id }}" {% if service.id == service_id %}checked{% endif %}>
                        {% if service.image %}
                            <img src="{{ service.image.url }}" alt="{{ service.name }}" class="service-image" style="width:200px; cursor:pointer">
                            <div>{{ service.name }}</div>

                        {% else %}
                            <div style="width:200px; cursor:pointer">{{ service.name }}</div>
                        {% endif %}
                    </label>
                </div>
                {% endfor %}
            </div>
            
            <button type="submit" style="display:none;">Submit</button> <!-- Hidden submit button -->
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const currentStep = "{{ request.resolver_match.url_name }}"; // Get the current step from Django context
        const steps = ['category', 'services', 'stylist', 'workday', 'workhour', 'review'];
    
        steps.forEach(step => {
            if (currentStep === step || steps.indexOf(step) <= steps.indexOf(currentStep)) {
                document.querySelector(`.nav-${step}`).classList.add('active');
            }
        });
    });
    $(document).ready(function() {
        // Handle click event on service image
        $('.service-image').on('click', function() {
            // Remove 'selected' styles from all service images
            $('.service-image').css({
                'border': 'none',
                'box-shadow': 'none'
            });

            // Add 'selected' styles to the clicked image
            $(this).css({
                'border': '2px solid #007bff',
                'box-shadow': '0px 0px 5px rgba(0, 123, 255, 0.5)'
            });

            // Select the corresponding radio button
            $(this).prev('input[type=radio]').prop('checked', true);

            // Submit the form
            $('#reservation-form').submit();
        });
    });
    $(document).ready(function() {
        $('#reservation-form').on('submit', function(event) {
            event.preventDefault(); // Prevent default form submission
        
            var formData = $(this).serialize(); // Serialize form data
            
            $.ajax({
                type: 'POST',
                url: '{% url "reserveform:services" %}',
                data: formData,
                success: function(response) {
                    if (response.success) {
                        window.location.href = response.redirect_url; // Redirect to services
                    } else {
                        alert('Error: ' + JSON.stringify(response.errors)); // Handle validation errors
                    }
                },
                error: function(xhr, status, error) {
                    console.error('AJAX Error:', status, error);
                    alert('An error occurred while processing your request: ' + xhr.responseText);
                }
            });
        });
    });
</script>
{% endblock %}